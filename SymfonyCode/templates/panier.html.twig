{% extends 'base.html.twig' %}
{% block title %}Panier{% endblock %}
{% block body %}

{% for message in app.flashes('success') %}
    <div class="flash-notification" style="position: fixed;
                                      top: 20px;
                                      left: 50%;
                                      transform: translateX(-50%);
                                      background: #30d135ff;
                                      color: white;
                                      padding: 15px;
                                      border-radius: 5px;
                                      z-index: 1000;
                                      display: flex;
                                      align-items: center;
                                      gap: 10px;">
        {{ message }}
        <button onclick="this.parentElement.remove()" 
                style="margin-left: 15px;
                       background: white;
                       color: #30d135ff;
                       border: none;
                       border-radius: 3px;
                       padding: 3px 8px;
                       cursor: pointer;">
            OK
        </button>
    </div>
{% endfor %}

{% for message in app.flashes('warning') %}
    <div class="flash-notification" style="position: fixed;
                                      top: 20px;
                                      left: 50%;
                                      transform: translateX(-50%);
                                      background: #e1b505ff;
                                      color: white;
                                      padding: 15px;
                                      border-radius: 5px;
                                      z-index: 1000;
                                      display: flex;
                                      align-items: center;
                                      gap: 10px;">
        {{ message }}
        <button onclick="this.parentElement.remove()" 
                style="margin-left: 15px;
                       background: white;
                       color:  #e1b505ff;
                       border: none;
                       border-radius: 3px;
                       padding: 3px 8px;
                       cursor: pointer;">
            OK
        </button>
    </div>
{% endfor %}

{% for message in app.flashes('danger') %}
    <div class="flash-notification" style="position: fixed;
                                      top: 20px;
                                      left: 50%;
                                      transform: translateX(-50%);
                                      background: #f44336;
                                      color: white;
                                      padding: 15px;
                                      border-radius: 5px;
                                      z-index: 1000;
                                      display: flex;
                                      align-items: center;
                                      gap: 10px;">
        {{ message }}
        <button onclick="this.parentElement.remove()" 
                style="margin-left: 15px;
                       background: white;
                       color: #f44336;
                       border: none;
                       border-radius: 3px;
                       padding: 3px 8px;
                       cursor: pointer;">
            OK
        </button>
    </div>
{% endfor %}

<section class="sub-header">
    <nav>
        <a href="/home"><img src="images/4bois1.jpeg"></a>
        <div class="nav-links" id="nav-links">
            <i class="fa fa-times" onclick="hideMenu()"></i>
            <ul>
                <li><a href="/home">ACCUEIL</a></li>
                <li><a href="/aboutUs">À PROPOS</a></li>
                <li><a href="/products">PRODUITS</a></li>
                <li><a href="/panier">PANIER</a></li>
                <li><a href="/contactUs">CONTACT</a></li>

                {% if app.user %}
                    <li class="nav-item">
                        <span class="nav-link"><i class="bi bi-person-circle me-1"></i>{{ app.user.username }}</span> 
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ path('app_logout_check') }}"><i class="bi bi-box-arrow-right me-1"></i>DÉCONNEXION</a>
                    </li>
                {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="/login"><i class="bi bi-box-arrow-in-right me-1"></i>CONNEXION</a>
                    </li>
                {% endif %}
            </ul>
        </div>
        <i class="fa fa-bars" onclick="showMenu()"></i>
    </nav>
</section>

<!-- PANIER -->
<div class="container mt-5">
    {% if panier is empty %}
        <div style="display: flex; justify-content: center; align-items: center; height: 78.5vh;">
    <div style="font-size: 2rem; font-weight: bold; color: black;">
        Votre panier est vide
    </div>
</div>   
        
    {% else %}
        <div class="table-responsive" style="display: flex; justify-content: center; align-items: center;height: 78.5vh;">
            <table  border="1" cellpadding="10">
                <thead style="background-color: #c1e5ffff;">
                    <tr>
                        <th>Produit</th>
                        <th>Prix</th>
                        <th>Date d'ajout</th>
                        <th>Quantité</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in panier %}
                        <tr>
                            <td>{{ item.nomProduit }}</td>
                            <td>{{ item.prixProduit }}</td>
                            <td class="text-center">{{ item.dateAjout|date('d/m/Y H:i') }}</td>
                            <td class="text-center">{{ item.quantite }}</td>
                            <td class="text-center">
                                <div class="btn-group">
                                    <a href="{{ path('panier_plus', {'id': item.id}) }}" 
                                       class="btn btn-sm btn-outline-success" title="Augmenter">
                                        <i class="fas fa-plus"></i>
                                    </a>
                                    <a href="{{ path('panier_moins', {'id': item.id}) }}" 
                                       class="btn btn-sm btn-outline-warning" title="Diminuer">
                                        <i class="fas fa-minus"></i>
                                    </a>
                                    <a href="{{ path('panier_supprimer', {'id': item.id}) }}" 
                                    class="btn btn-sm btn-outline-danger btn-delete" 
                                    data-id="{{ item.id }}" title="Supprimer">
                                        <i class="fas fa-trash-alt"></i>
                                    </a>

                                    
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        
        </div>

        {# Bouton Passer la commande #}
        <div style=" margin-bottom: 2%; display:flex; justify-content: center; align-items: center;">
            <a href="{{ path('passer_commande_check') }}" 
                class="btn btn-sm" 
                style="background-color: #b2642e; color: white; font-size: 1.2rem; padding: 12px 25px;" >
                <i class="fas fa-shopping-cart"> Passer la commande</i>
            </a>
        </div>
        
    {% endif %}
</div>

<style>
/*----------Panier page---------*/
.btn {
    display: inline-block;
    padding: 6px 10px;
    margin: 0 3px;
    border-radius: 6px;
    font-size: 14px;
    text-decoration: none;
    color: white;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.btn-sm {
    font-size: 12px;
    padding: 4px 8px;
}

.btn-outline-success {
    background-color: #28a745;
}

.btn-outline-warning {
    background-color: #ffc107;
    color: black;
}

.btn-outline-danger {
    background-color: #dc3545;
}

.btn:hover {
    opacity: 0.85;
}

/* Pour centrer les icônes à l’intérieur */
.btn i {
    margin: 0;
    pointer-events: none;
}

table {
    border-collapse: collapse;
    width: 90%;
    margin-top: 30px;    
    margin-bottom: 30px; 
    margin-left: auto;
    margin-right: auto;
}

table, th, td {
    border: 1px solid #d3d7dbff; 
}

th, td {
    padding: 12px 15px;
    text-align: left;
}

tr:nth-child(even) {
    background-color: #f2f2f2; 
}

tr:hover {
    background-color: #e9ecef; 
}

.table-bordered {
    border: 2px solid #343a40; 
}

</style>

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Fonction pour afficher une notification
            function showNotification(message, type = 'danger') { // 'danger' par défaut
                // Supprimer les notifications existantes
                document.querySelectorAll('.flash-notification').forEach(n => n.remove());
                
                const colors = {
                    'success': '#4CAF50',
                    'warning': '#ff9843ff',
                    'danger': '#ff1100ff'
                };
                
                const bgColor = colors[type] || colors['danger'];
                
                // Créer la notification
                const notif = document.createElement("div");
                notif.className = "flash-notification";
                notif.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: ${bgColor};
                    color: white;
                    padding: 15px;
                    border-radius: 5px;
                    z-index: 1000;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    animation: fadeIn 0.3s ease-in-out;
                `;
                
                notif.innerHTML = `
                    ${message}
                    <button onclick="this.parentElement.remove()" 
                            style="margin-left: 15px;
                                   background: white;
                                   color: ${bgColor};
                                   border: none;
                                   border-radius: 3px;
                                   padding: 3px 8px;
                                   cursor: pointer;">
                        OK
                    </button>
                `;
                
                document.body.appendChild(notif);
                
                // Disparition automatique après 5s
                setTimeout(() => {
                    if (notif.parentNode) {
                        notif.style.animation = 'fadeOut 0.3s ease-in-out';
                        setTimeout(() => notif.remove(), 300);
                    }
                }, 5000);
            }

            // Gestion des boutons de suppression
            document.querySelectorAll(".btn-delete").forEach(function (btn) {
                btn.addEventListener("click", function (e) {
                    e.preventDefault();
                    const url = this.getAttribute("href");

                    if (confirm("Cliquez sur OK pour confirmer la suppression du produit \nCliquez sur Annuler pour annuler la suppression du produit.")) {
                        window.location.href = url; // La notification sera gérée par Symfony
                    } else {
                        showNotification("Suppression du produit annulée", 'danger');
                    }
                });
            });
        });

        // Animations CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translate(-50%, -20px); }
                to { opacity: 1; transform: translate(-50%, 0); }
            }
            @keyframes fadeOut {
                from { opacity: 1; transform: translate(-50%, 0); }
                to { opacity: 0; transform: translate(-50%, -20px); }
            }
        `;
        document.head.appendChild(style);
    </script>
{% endblock %}

{% endblock %}